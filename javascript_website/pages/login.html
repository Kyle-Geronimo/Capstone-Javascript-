<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HotelLink - Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../css/styles.css" />
  <!-- Modern auth-specific styles (override and enhancements) -->
  <link rel="stylesheet" href="../css/auth-modern.css" />

  <!-- Small page-specific tweaks so the login card centers like signup -->
  <style>
    /* Page background (kept same as signup for consistent look) */
    body.auth-background {
      background-image:
        linear-gradient(180deg, rgba(246,250,255,0.56), rgba(245,247,255,0.56)),
        url('/image/bg/BG.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 28px;
    }

    /* subtle overlay so foreground pops */
    body.auth-background::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(8, 18, 40, 0.28);
      pointer-events: none;
      z-index: 0;
    }

    /* Ensure the form column is centered and constrained like signup */
    .auth-form-col {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 640px; /* same width as signup for visual parity */
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 160px); /* leaves room for header/footer */
      box-sizing: border-box;
    }

    /* Keep the glass card appearance and behavior consistent */
    .auth-card {
      background: rgba(255, 255, 255, 0.62);
      border: 1px solid rgba(255, 255, 255, 0.55);
      box-shadow: 0 18px 50px rgba(2, 6, 23, 0.26);
      border-radius: 14px;
      padding: 22px;
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      transition: transform 160ms ease, box-shadow 160ms ease;
      width: 100%;
      max-width: 520px; /* keep the card a bit narrower than the column */
    }

    .auth-card:focus-within,
    .auth-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 28px 70px rgba(2, 6, 23, 0.32);
    }

    /* Accessibility opt-out for blur/transparency */
    @media (prefers-reduced-transparency: reduce), (prefers-reduced-motion: reduce) {
      .auth-card {
        background: #fff;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        transform: none !important;
        transition: none !important;
      }
      body.auth-background::before {
        background: rgba(8, 18, 40, 0.18);
      }
    }

    footer .container p {
      color: rgba(255,255,255,0.9);
      mix-blend-mode: lighten;
    }

    /* Ensure show-password button remains above background overlays */
    .show-password-btn { position: relative; z-index: 2; }
  </style>
</head>
<body class="auth-background">

  <!-- Form column (now centered vertically and horizontally) -->
  <main class="auth-form-col" id="login-title" aria-label="Login form">
    <div class="auth-card" role="region" aria-labelledby="login-heading">
      <div class="card-head">
        <img src="/image/logo/HTLogo.png" alt="" style="width:44px;height:44px;border-radius:8px;background:transparent;" />
        <div>
          <h2 id="login-heading">Welcome Back</h2>
          <p class="sub">Please sign in to continue to your staff dashboard.</p>
        </div>
      </div>

      <form id="login-form" class="form-grid" novalidate>
        <!-- Announcer for screen readers -->
        <div id="auth-announcer" aria-live="polite" class="visually-hidden"></div>

        <div class="field input-wrap">
          <label for="login-email" class="form-label">Email address</label>
          <div style="position:relative;">
            <div class="icon" aria-hidden="true">
              <!-- simple inline svg for email -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path d="M3 7.5L12 13L21 7.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <rect x="3" y="4" width="18" height="16" rx="3" stroke="currentColor" stroke-width="1.4"/>
              </svg>
            </div>
            <input id="login-email" class="input form-control" type="email" placeholder="you@hotel.com" required aria-required="true" />
          </div>
        </div>

        <div class="field input-wrap">
          <label for="login-password" class="form-label">Password</label>
          <div style="position:relative;">
            <div class="icon" aria-hidden="true">
              <!-- lock icon -->
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <rect x="3" y="11" width="18" height="10" rx="2" stroke="currentColor" stroke-width="1.4"/>
                <path d="M7 11V8a5 5 0 0 1 10 0v3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <input id="login-password" class="input form-control" type="password" data-strength="true" placeholder="Enter your password" required aria-required="true" />
            <button type="button" class="show-password-btn" data-target="login-password" aria-pressed="false" aria-label="Show password">Show</button>
          </div>
        </div>

        <div class="row" style="margin-top:6px;">
          <label class="checkbox" for="remember">
            <input type="checkbox" name="remember" id="remember" /> Remember me
          </label>
          <a href="reset-password.html" class="link-btn">Forgot password?</a>
        </div>

        <div class="button-container center-button" style="margin-top:12px;">
          <button id="login-btn" class="btn-primary action-btn primary" type="submit">Sign in</button>
        </div>

        <div class="auth-footer">
          <p class="text-center">Not registered? <a href="signup.html">Create an account</a></p>
        </div>
      </form>
    </div>
  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Dâ€™ Mariners Inn Hotel. All rights reserved.</p>
    </div>
  </footer>

  <script type="module">
    import { auth } from '../js/firebase-config.js';
    import { login } from '../js/auth.js';
    import { updateNavVisibility } from '../js/nav-control.js';
    import { initShowPassword } from '../js/show-password.js';
    import { initAuthEnhancements } from '../js/auth-enhancements.js';

    // Initialize UI helpers (password toggle, strength meter, inline validation)
    initShowPassword && typeof initShowPassword === 'function' && initShowPassword();
    initAuthEnhancements && typeof initAuthEnhancements === 'function' && initAuthEnhancements();

    // Keep nav state accurate
    updateNavVisibility && updateNavVisibility();

    // Handle form submit to work with keyboard events and better accessibility
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const announcer = document.getElementById('auth-announcer');
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      try {
        document.getElementById('login-btn').disabled = true;
        document.getElementById('login-btn').textContent = 'Signing in...';
        await login(email, password);
        // on success redirect
        window.location.href = '../index.html';
      } catch (err) {
        console.error("Login failed:", err);
        const message = "Login failed: " + (err && err.message ? err.message : err);
        announcer.textContent = message;
        alert(message);
        document.getElementById('login-btn').disabled = false;
        document.getElementById('login-btn').textContent = 'Sign in';
      }
    });

    // Initial check for nav state
    updateNavVisibility && updateNavVisibility();
  </script>
</body>
</html>